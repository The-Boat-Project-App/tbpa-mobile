{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = useImageConcreteDimensions;\nvar _react = require(\"react\");\nfunction extractHorizontalSpace(_ref) {\n  var marginHorizontal = _ref.marginHorizontal,\n    leftMargin = _ref.leftMargin,\n    rightMargin = _ref.rightMargin,\n    margin = _ref.margin;\n  var realLeftMargin = leftMargin || marginHorizontal || margin || 0;\n  var realRightMargin = rightMargin || marginHorizontal || margin || 0;\n  return realLeftMargin + realRightMargin;\n}\nfunction scaleUp(minDimensions, desiredDimensions) {\n  var aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width < minDimensions.width) {\n    return scaleUp(minDimensions, {\n      width: minDimensions.width,\n      height: minDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height < minDimensions.height) {\n    return scaleUp(minDimensions, {\n      height: minDimensions.height,\n      width: minDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\nfunction scaleDown(maxDimensions, desiredDimensions) {\n  var aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width > maxDimensions.width) {\n    return scaleDown(maxDimensions, {\n      width: maxDimensions.width,\n      height: maxDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height > maxDimensions.height) {\n    return scaleDown(maxDimensions, {\n      height: maxDimensions.height,\n      width: maxDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\nfunction scale(_ref2, originalBox) {\n  var minBox = _ref2.minBox,\n    maxBox = _ref2.maxBox;\n  return scaleDown(maxBox, scaleUp(minBox, originalBox));\n}\nfunction computeConcreteDimensions(params) {\n  var computeMaxWidth = params.computeMaxWidth,\n    contentWidth = params.contentWidth,\n    flattenStyles = params.flattenStyles,\n    naturalWidth = params.naturalWidth,\n    naturalHeight = params.naturalHeight,\n    specifiedWidth = params.specifiedWidth,\n    specifiedHeight = params.specifiedHeight;\n  var horizontalSpace = extractHorizontalSpace(flattenStyles);\n  var _flattenStyles$maxWid = flattenStyles.maxWidth,\n    maxWidth = _flattenStyles$maxWid === void 0 ? Infinity : _flattenStyles$maxWid,\n    _flattenStyles$maxHei = flattenStyles.maxHeight,\n    maxHeight = _flattenStyles$maxHei === void 0 ? Infinity : _flattenStyles$maxHei,\n    _flattenStyles$minWid = flattenStyles.minWidth,\n    minWidth = _flattenStyles$minWid === void 0 ? 0 : _flattenStyles$minWid,\n    _flattenStyles$minHei = flattenStyles.minHeight,\n    minHeight = _flattenStyles$minHei === void 0 ? 0 : _flattenStyles$minHei;\n  var imagesMaxWidth = typeof contentWidth === 'number' ? computeMaxWidth(contentWidth) : Infinity;\n  var minBox = {\n    width: minWidth,\n    height: minHeight\n  };\n  var maxBox = {\n    width: Math.min(imagesMaxWidth, maxWidth, typeof specifiedWidth === 'number' ? specifiedWidth : Infinity) - horizontalSpace,\n    height: Math.min(typeof specifiedHeight === 'number' ? specifiedHeight : Infinity, maxHeight)\n  };\n  if (typeof specifiedWidth === 'number' && typeof specifiedHeight === 'number') {\n    return scale({\n      minBox: minBox,\n      maxBox: maxBox\n    }, {\n      width: specifiedWidth,\n      height: specifiedHeight\n    });\n  }\n  if (naturalWidth != null && naturalHeight != null) {\n    return scale({\n      minBox: minBox,\n      maxBox: maxBox\n    }, {\n      width: naturalWidth,\n      height: naturalHeight\n    });\n  }\n  return null;\n}\nfunction useImageConcreteDimensions(_ref3) {\n  var flatStyle = _ref3.flatStyle,\n    naturalDimensions = _ref3.naturalDimensions,\n    specifiedDimensions = _ref3.specifiedDimensions,\n    computeMaxWidth = _ref3.computeMaxWidth,\n    contentWidth = _ref3.contentWidth;\n  return (0, _react.useMemo)(function () {\n    return computeConcreteDimensions({\n      flattenStyles: flatStyle,\n      computeMaxWidth: computeMaxWidth,\n      contentWidth: contentWidth,\n      naturalWidth: naturalDimensions === null || naturalDimensions === void 0 ? void 0 : naturalDimensions.width,\n      naturalHeight: naturalDimensions === null || naturalDimensions === void 0 ? void 0 : naturalDimensions.height,\n      specifiedWidth: specifiedDimensions.width,\n      specifiedHeight: specifiedDimensions.height\n    });\n  }, [computeMaxWidth, contentWidth, flatStyle, naturalDimensions, specifiedDimensions.height, specifiedDimensions.width]);\n}","map":{"version":3,"mappings":"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","names":["extractHorizontalSpace","marginHorizontal","leftMargin","rightMargin","margin","realLeftMargin","realRightMargin","scaleUp","minDimensions","desiredDimensions","aspectRatio","width","height","scaleDown","maxDimensions","scale","originalBox","minBox","maxBox","computeConcreteDimensions","params","computeMaxWidth","contentWidth","flattenStyles","naturalWidth","naturalHeight","specifiedWidth","specifiedHeight","horizontalSpace","maxWidth","Infinity","maxHeight","minWidth","minHeight","imagesMaxWidth","Math","min","useImageConcreteDimensions","flatStyle","naturalDimensions","specifiedDimensions"],"sources":["useImageConcreteDimensions.ts"],"sourcesContent":["import { useMemo } from 'react';\nimport { ImageStyle } from 'react-native';\nimport { ImageDimensions } from '../shared-types';\nimport {\n  IncompleteImageDimensions,\n  UseIMGElementStateProps\n} from './img-types';\n\nexport type ConcreteDimensionsProps = {\n  flatStyle: ImageStyle;\n  naturalDimensions: ImageDimensions | null;\n  specifiedDimensions: IncompleteImageDimensions;\n} & Pick<UseIMGElementStateProps, 'computeMaxWidth' | 'contentWidth'>;\n\nfunction extractHorizontalSpace({\n  marginHorizontal,\n  leftMargin,\n  rightMargin,\n  margin\n}: any) {\n  const realLeftMargin = leftMargin || marginHorizontal || margin || 0;\n  const realRightMargin = rightMargin || marginHorizontal || margin || 0;\n  return realLeftMargin + realRightMargin;\n}\n\nfunction scaleUp(\n  minDimensions: ImageDimensions,\n  desiredDimensions: ImageDimensions\n): ImageDimensions {\n  const aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width < minDimensions.width) {\n    return scaleUp(minDimensions, {\n      width: minDimensions.width,\n      height: minDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height < minDimensions.height) {\n    return scaleUp(minDimensions, {\n      height: minDimensions.height,\n      width: minDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\n\nfunction scaleDown(\n  maxDimensions: ImageDimensions,\n  desiredDimensions: ImageDimensions\n): ImageDimensions {\n  const aspectRatio = desiredDimensions.width / desiredDimensions.height;\n  if (desiredDimensions.width > maxDimensions.width) {\n    return scaleDown(maxDimensions, {\n      width: maxDimensions.width,\n      height: maxDimensions.width / aspectRatio\n    });\n  }\n  if (desiredDimensions.height > maxDimensions.height) {\n    return scaleDown(maxDimensions, {\n      height: maxDimensions.height,\n      width: maxDimensions.height * aspectRatio\n    });\n  }\n  return desiredDimensions;\n}\n\nfunction scale(\n  { minBox, maxBox }: { maxBox: ImageDimensions; minBox: ImageDimensions },\n  originalBox: ImageDimensions\n) {\n  return scaleDown(maxBox, scaleUp(minBox, originalBox));\n}\n\nfunction computeConcreteDimensions(params: any) {\n  const {\n    computeMaxWidth,\n    contentWidth,\n    flattenStyles,\n    naturalWidth,\n    naturalHeight,\n    specifiedWidth,\n    specifiedHeight\n  } = params;\n  const horizontalSpace = extractHorizontalSpace(flattenStyles);\n  const {\n    maxWidth = Infinity,\n    maxHeight = Infinity,\n    minWidth = 0,\n    minHeight = 0\n  } = flattenStyles;\n  const imagesMaxWidth =\n    typeof contentWidth === 'number' ? computeMaxWidth(contentWidth) : Infinity;\n  const minBox = {\n    width: minWidth,\n    height: minHeight\n  };\n  const maxBox = {\n    width:\n      Math.min(\n        imagesMaxWidth,\n        maxWidth,\n        typeof specifiedWidth === 'number' ? specifiedWidth : Infinity\n      ) - horizontalSpace,\n    height: Math.min(\n      typeof specifiedHeight === 'number' ? specifiedHeight : Infinity,\n      maxHeight\n    )\n  };\n  if (\n    typeof specifiedWidth === 'number' &&\n    typeof specifiedHeight === 'number'\n  ) {\n    return scale(\n      { minBox, maxBox },\n      {\n        width: specifiedWidth,\n        height: specifiedHeight\n      }\n    );\n  }\n  if (naturalWidth != null && naturalHeight != null) {\n    return scale(\n      { minBox, maxBox },\n      {\n        width: naturalWidth,\n        height: naturalHeight\n      }\n    );\n  }\n  return null;\n}\n\nexport default function useImageConcreteDimensions<\n  P extends ConcreteDimensionsProps\n>({\n  flatStyle,\n  naturalDimensions,\n  specifiedDimensions,\n  computeMaxWidth,\n  contentWidth\n}: P): P['naturalDimensions'] extends ImageDimensions\n  ? ImageDimensions\n  : ImageDimensions | null {\n  return useMemo(() => {\n    return computeConcreteDimensions({\n      flattenStyles: flatStyle,\n      computeMaxWidth,\n      contentWidth,\n      naturalWidth: naturalDimensions?.width,\n      naturalHeight: naturalDimensions?.height,\n      specifiedWidth: specifiedDimensions.width,\n      specifiedHeight: specifiedDimensions.height\n    }) as any;\n  }, [\n    computeMaxWidth,\n    contentWidth,\n    flatStyle,\n    naturalDimensions,\n    specifiedDimensions.height,\n    specifiedDimensions.width\n  ]);\n}\n"]},"metadata":{},"sourceType":"script"}